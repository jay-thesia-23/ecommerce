<html>

<head>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.colVis.min.js"></script>
</head>

<body>
  <table id="myTable">
    <thead>
      <tr>
        <th>id</th>
        <th>name</th>
        <th>email</th>
        <th>roleId</th>
        <th>Edit</th>
        <th>delete</th>
      </tr>
    </thead>

    <tbody id="data">
      <%for(let i=0;i<data.length;i++){%>

        <tr>
          <td >
            <%=data[i].id%>
          </td>
          <td id="name_<%=data[i].id%>">
            <%=data[i].name%>
          </td>
          <td id="email_<%=data[i].id%>">
            <%=data[i].email%>
          </td>
          <td id="role_<%=data[i].id%>">
            <%=data[i].roleId%>
          </td>
          <td style="cursor:pointer" id="<%=data[i].id%>" onclick="edit(this)" data-bs-target="#editModel" data-bs-toggle="modal"><i class="fa fa-edit" /> </td>
          <td style="cursor:pointer" id="<%=data[i].id%>" onclick="remove(this)"><i class="fa fa-trash" />
        </tr>

        </tr>


        <%}%>
    </tbody>
  </table>

  <div id="editpopup" style="display: block">

   </div>

 
  
  
</body>

<script>
  var currtbl = $(document).ready(function () {
    $("#myTable").DataTable({
      serverSide: false,
      processing: false,
      searching: true,
      ordering: true,
      paging: true,
      // serverMethod: "get",
      // // dom: "Bfrtip",
      // buttons: ["colvis"],

      lengthMenu: [
        [5, 15, 20, 25, 50, 100, 1844674407370955161],
        [5, 15, 20, 25, 50, 100, "All"],
      ],
      // ajax: {
      //   url: "/adminPanel",
      //   type: "get",

      // },

      // columns: [
      //   { data:"id" },
      //   { data: "name" },
      //   { data: "email" },
      //   { data: "roleId" },
      //   { data: null,
      //     id:"null",
      //         className: "dt-center editor-edit",
      //         defaultContent: '<i class="fa fa-pencil"/>',
      //         orderable: false
      //   },
      //   {

      //         data: null,
      //         className: "dt-center editor-delete",
      //         defaultContent: '<i class="fa fa-trash"/>',
      //         orderable: false
      //     }

      // ],
    });
  });
  ;


  async function remove(user) {

    const deleted = await fetch("/adminPanel/deleteUser", {
      method: "Post",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        "userId": user.id
      })
    })

    window.location.reload()
  }

  function edit(user){

    let id=user.id
    let popUp=document.getElementById("editpopup")
    console.log(user.parentElement);



    let userName=`name_${id}`
    let userEmail=`email_${id}`
    let userRole=`role_${id}`

    let name=document.getElementById(`${userName}`).innerText;
    let email=document.getElementById(`${userEmail}`).innerText
    let role=document.getElementById(`${userRole}`).innerText

    console.log(name,email,role);

    let s=`<div class="moda" id="editModel" tabindex="-1" aria-labelledby="exampleModalLabel" >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Edit user</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Name:</label>
              <input type="text" class="form-control" style="color:red" value="${name}" id="name">
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">Email:</label>
              <input type="text" class="form-control" value="${email} id="email">
            </div>

            <div class="mb-3">
              <label for="message-text" class="col-form-label">Role:</label>

            
              <input type="radio" name="role" id="Admin"> Admin
              <input type="radio" name="role" id="User"> User
              <input type="radio" name="role" id="UserAdmin"> UserAdmin
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Send message</button>
        </div>
      </div>
    </div>
  </div>`;

  console.log(s);


popUp.innerHTML=s
    

  }

</script>

</html>