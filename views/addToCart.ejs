<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"
  ></script>
    <title>Cart</title>
</head>
<body>
    <h2>Item's in your cart ðŸ›’</h2>


  

    <div class="sections container ml-auto">
        <section class="product-section mt-5">
          <div class="row ">

          <%let grandTotal=0 %>
          <%for(let i=0;i<getCart.length;i++){%>

            

            <div class="col-3 " id="<%=getCart[i].id%>">
              <div class="card"  style="width: 18rem">
                    <img
                      src="uploads/<%=getCart[i].productImage%>"
                      class="card-img-top rounded-2 p-3"
                      alt="..."
                      height="250px"
                    />
                    <div class="card-body">
                      <h5 class="card-title"><%=getCart[i].productName %></h5>
                     
                      
                      <p class="text-succes d-inline font-weight-bold">â‚¹ <%=getCart[i].productPrice%></p><span> x<%=quantity[i].productQuantity%></span>
                      <%let total=getCart[i].productPrice * quantity[i].productQuantity;%>
                      
                     
                      <%grandTotal=grandTotal+total;console.log(grandTotal) %>

                      <%grandTotal%>
                      <h4 class="text-success">â‚¹ <%-total %></h4>
      
                      <div class="purchase">
                        <span href="" class="me-2" id="<%=getCart[i].id %>" onclick="addToCart(this)"
                          ><img
                            src="/images/plusOne.png"
                            style="width: 1.7rem"
                            alt=""
                            srcset=""
                        /></span>
      
                        <a href=""
                          ><img
                            class="me-2"
                            src="/images/buynow.png"
                            style="width: 3rem"
                            alt=""
                            srcset=""
                        /></a>
    
                        <img src="/images/remove.png" id="<%=quantity[i].id%>" style="width: 2rem" alt="" srcset="" onclick="removeCart(this)">
    
    
                      </div>
    
                  
                    </div>
              </div>
          </div>
            <% }%>
        
            
          </div>
        </section>
      </div>
      <div class="d-flex flex-column text-center p-5 mt-5  bg-success bg-gradient">
  
        <h2 class="mt-3 mb-3">Grand Total:<%-grandTotal%></h2>
        <h5 class="mb-3">subtotal:<%-grandTotal%></h5>
        <h5 class="mb-3">tax:0</h5>

        <div class="d-inline">
          <input type="submit" value="Buy Now" class="btn btn-danger ">
        </div>
      
    </div>
  
<script>

async function removeCart(cart) {
   

    const cartAdd = await fetch("/addcart/removeproduct", {
        method: "POST",
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            "idCart": cart.id
        })
    })

    window.location.reload()

}

async function addToCart(product) {

    console.log(product.id);
    const cartAdd = await fetch("/dashboard/cart", {
        method: "POST",
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            "productId": product.id
        })
    })

    const ans = cartAdd.json()

    window.location.reload()
    console.log(ans, "inside ans ejs");
}
      
      
</script>
</body>
</html>
